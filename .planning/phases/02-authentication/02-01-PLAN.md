---
phase: 02-authentication
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/contexts/AuthContext.tsx
  - src/components/auth/LoginForm.tsx
  - src/components/auth/SignupForm.tsx
autonomous: true

must_haves:
  truths:
    - "AuthContext provides session state to entire app"
    - "signUp function calls Supabase auth.signUp"
    - "signIn function calls Supabase auth.signInWithPassword"
    - "signOut function calls Supabase auth.signOut"
    - "onAuthStateChange listener updates session reactively"
    - "getSession is called on mount to restore persisted session"
  artifacts:
    - path: "src/contexts/AuthContext.tsx"
      provides: "Auth provider, useAuth hook, session state management"
      exports: ["AuthProvider", "useAuth"]
      min_lines: 50
    - path: "src/components/auth/LoginForm.tsx"
      provides: "Email/password login form with error handling"
      min_lines: 40
    - path: "src/components/auth/SignupForm.tsx"
      provides: "Registration form with email/password"
      min_lines: 40
  key_links:
    - from: "src/contexts/AuthContext.tsx"
      to: "src/lib/supabase.ts"
      via: "import and auth method calls"
      pattern: "supabase\\.auth\\.(signUp|signInWithPassword|signOut|onAuthStateChange)"
    - from: "src/contexts/AuthContext.tsx"
      to: "src/lib/supabase.ts"
      via: "getSession call on mount for session persistence"
      pattern: "supabase\\.auth\\.getSession"
    - from: "src/components/auth/LoginForm.tsx"
      to: "src/contexts/AuthContext.tsx"
      via: "useAuth hook"
      pattern: "useAuth\\(\\)"
---

<objective>
Create authentication foundation with AuthContext and auth forms.

Purpose: Establish the core auth infrastructure that all protected features will depend on. AuthContext provides centralized session management, and forms enable user interaction with Supabase Auth.

Output: AuthContext provider with useAuth hook, LoginForm component, SignupForm component, react-router and heroicons installed.
</objective>

<execution_context>
@/Users/yedidya/.claude/get-shit-done/workflows/execute-plan.md
@/Users/yedidya/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-authentication/02-RESEARCH.md
@src/lib/supabase.ts
@src/styles/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and create AuthContext</name>
  <files>
    - package.json
    - src/contexts/AuthContext.tsx
  </files>
  <action>
1. Install required dependencies:
   ```bash
   npm install react-router @heroicons/react
   ```

2. Create `src/contexts/` directory if not exists.

3. Create `src/contexts/AuthContext.tsx` implementing:
   - AuthContextType interface with: session, user, loading, signUp, signIn, signOut
   - AuthProvider component that:
     - Uses useState for session (Session | null) and loading (boolean, initial: true)
     - On mount: calls supabase.auth.getSession() to get initial session, sets loading false
     - Sets up supabase.auth.onAuthStateChange listener that updates session state
     - Unsubscribes from listener on unmount (cleanup function)
   - signUp: calls supabase.auth.signUp({ email, password }), returns { error }
   - signIn: calls supabase.auth.signInWithPassword({ email, password }), returns { error }
   - signOut: calls supabase.auth.signOut({ scope: 'local' }) for single-device logout
   - useAuth hook that throws if used outside AuthProvider

Use types from @supabase/supabase-js: Session, User
Import supabase from @/lib/supabase (path alias already configured)
  </action>
  <verify>
- `npm ls react-router @heroicons/react` shows both installed
- `cat src/contexts/AuthContext.tsx` shows AuthProvider and useAuth exports
- `grep -q "getSession" src/contexts/AuthContext.tsx && echo "getSession present"` - confirms session persistence call
- No TypeScript errors: `npx tsc --noEmit`
  </verify>
  <done>
- react-router and @heroicons/react in package.json dependencies
- AuthContext.tsx exports AuthProvider component and useAuth hook
- AuthProvider calls getSession() on mount for session persistence (AUTH-02)
- AuthProvider manages session state with onAuthStateChange
- signUp, signIn, signOut functions wrap Supabase auth methods
  </done>
</task>

<task type="auto">
  <name>Task 2: Create LoginForm and SignupForm components</name>
  <files>
    - src/components/auth/LoginForm.tsx
    - src/components/auth/SignupForm.tsx
  </files>
  <action>
1. Create `src/components/` and `src/components/auth/` directories if not exist.

2. Create `src/components/auth/LoginForm.tsx`:
   - Form with email (type="email") and password (type="password") inputs
   - Local state: email, password, error (string), loading (boolean)
   - On submit: prevent default, setLoading(true), call signIn from useAuth
   - If error: display error message, setLoading(false)
   - If success: navigation handled by parent (form just calls signIn)
   - Style with Tailwind: dark theme compatible (use bg-surface, text-text, border-surface classes)
   - Include link to signup page: "Need an account? Sign up"
   - Use EnvelopeIcon and LockClosedIcon from @heroicons/react/24/outline for input icons
   - Disable submit button while loading, show "Signing in..." text

3. Create `src/components/auth/SignupForm.tsx`:
   - Similar structure to LoginForm
   - Calls signUp instead of signIn
   - Shows success message if signUp returns without error but session is null (email confirmation required)
   - Include link to login page: "Already have an account? Sign in"
   - Use same Tailwind styling approach for consistency

Both forms should:
- Use controlled inputs with value/onChange
- Have proper form submission handling (onSubmit, not onClick on button)
- Display errors in red (text-red-500)
- Be responsive (max-w-md, mx-auto for centering)
  </action>
  <verify>
- `cat src/components/auth/LoginForm.tsx` shows form with email/password inputs
- `cat src/components/auth/SignupForm.tsx` shows form with email/password inputs
- Both files import useAuth from @/contexts/AuthContext
- No TypeScript errors: `npx tsc --noEmit`
  </verify>
  <done>
- LoginForm.tsx renders email/password form, calls signIn on submit, shows errors
- SignupForm.tsx renders email/password form, calls signUp on submit, handles email confirmation case
- Both forms use Tailwind dark theme classes and heroicons
- Both forms have proper loading states and error display
  </done>
</task>

</tasks>

<verification>
After completing both tasks:
1. `npm ls react-router @heroicons/react` - both packages installed
2. `npx tsc --noEmit` - no TypeScript errors
3. Files exist: AuthContext.tsx, LoginForm.tsx, SignupForm.tsx
4. AuthContext exports AuthProvider and useAuth
5. AuthContext calls getSession() on mount (grep confirms)
6. Forms import and use useAuth hook
</verification>

<success_criteria>
- Dependencies installed: react-router, @heroicons/react
- AuthContext.tsx provides session management with Supabase auth
- AuthContext.tsx calls getSession() on mount for session persistence (AUTH-02)
- LoginForm.tsx enables email/password login with error handling
- SignupForm.tsx enables registration with email confirmation handling
- All components use dark theme compatible Tailwind classes
- No TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-authentication/02-01-SUMMARY.md`
</output>
