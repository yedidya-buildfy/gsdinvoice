---
phase: 03-navigation-ui-shell
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - index.html
  - src/styles/globals.css
  - src/components/layout/AppShell.tsx
  - src/components/layout/Sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "Dark theme applied immediately on page load (no flash)"
    - "Sidebar displays with navigation items"
    - "Sidebar can collapse and expand"
    - "Sidebar state persists across browser refresh"
  artifacts:
    - path: "src/components/layout/AppShell.tsx"
      provides: "Layout wrapper with sidebar and content area"
      exports: ["AppShell"]
    - path: "src/components/layout/Sidebar.tsx"
      provides: "Collapsible sidebar with navigation"
      exports: ["Sidebar"]
  key_links:
    - from: "index.html"
      to: "localStorage vat-manager-ui"
      via: "inline script"
      pattern: "vat-manager-ui"
    - from: "src/components/layout/Sidebar.tsx"
      to: "src/stores/uiStore.ts"
      via: "useUIStore hook"
      pattern: "useUIStore"
---

<objective>
Create the application shell with dark theme and collapsible sidebar navigation.

Purpose: Establish the core UI framework that will wrap all authenticated pages
Output: AppShell and Sidebar components with dark theme properly applied
</objective>

<execution_context>
@/Users/yedidya/.claude/get-shit-done/workflows/execute-plan.md
@/Users/yedidya/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-navigation-ui-shell/03-RESEARCH.md

# Existing code
@src/stores/uiStore.ts
@src/styles/globals.css
@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure dark theme with FOUC prevention</name>
  <files>
    - index.html
    - src/styles/globals.css
  </files>
  <action>
    1. Update index.html:
       - Add inline script in <head> BEFORE any stylesheets to read theme from localStorage ('vat-manager-ui' key)
       - If theme is 'dark' OR no preference stored, add 'dark' class to documentElement
       - Update title to "VAT Declaration Manager"
       - Add lang="he" to html element for Hebrew support

    2. Update src/styles/globals.css:
       - Add @custom-variant dark (&:where(.dark, .dark *)) for Tailwind v4 dark mode
       - Keep existing @theme colors (they are already dark theme colors)
       - Add text-secondary color variant: --color-text-secondary: #64748b
       - Add error color: --color-error: #ef4444
       - Add success color: --color-success: #10b981

    3. Clean up src/index.css (if exists) to remove Vite defaults that conflict
       - The body styles with place-items: center breaks full-width layouts
       - Remove conflicting button/link styles
  </action>
  <verify>
    - npm run dev and verify no white flash on page load
    - Inspect html element has class="dark"
    - Theme colors available in Tailwind (test with bg-primary, text-text-muted)
  </verify>
  <done>Dark theme loads instantly without flash, theme CSS variables available throughout app</done>
</task>

<task type="auto">
  <name>Task 2: Create AppShell and Sidebar components</name>
  <files>
    - src/components/layout/AppShell.tsx
    - src/components/layout/Sidebar.tsx
  </files>
  <action>
    1. Create src/components/layout/Sidebar.tsx:
       - Import NavLink from react-router (NOT react-router-dom)
       - Import icons from @heroicons/react/24/outline (thin outline per user preference):
         - HomeIcon for Dashboard
         - BanknotesIcon for Bank Movements
         - DocumentTextIcon for Invoices & Receipts
         - CreditCardIcon for Credit Card
         - Cog6ToothIcon for Settings
         - ChevronLeftIcon / ChevronRightIcon for collapse toggle
       - Import useUIStore for sidebar state
       - Create navItems array with: to, icon, label for each page
       - Render fixed sidebar with:
         - Position: fixed inset-y-0 start-0 (use logical property for RTL)
         - Width: w-64 expanded, w-16 collapsed (transition-all duration-300)
         - Background: bg-surface
         - Border: border-e border-text-muted/20 (logical property)
         - Z-index: z-40
       - Header section with app name and collapse toggle button
       - Navigation section using NavLink with isActive styling:
         - Active: bg-primary/10 text-primary
         - Inactive: text-text-muted hover:bg-background hover:text-text
       - Use end prop on Dashboard NavLink (to="/") to prevent always-active
       - Show only icons when collapsed, full label when expanded
       - Add title attribute to NavLink when collapsed for accessibility

    2. Create src/components/layout/AppShell.tsx:
       - Import Outlet from react-router
       - Import Sidebar component
       - Import useUIStore for sidebar collapsed state
       - Render wrapper div with min-h-screen bg-background
       - Render Sidebar component
       - Render main element with:
         - Padding-start that matches sidebar width (ps-64 / ps-16)
         - transition-all duration-300 for smooth resize
       - Render <Outlet /> inside main for nested routes
  </action>
  <verify>
    - Import components in a test file and verify no TypeScript errors
    - Check that useUIStore hook connects properly
    - Verify NavLink imports work from 'react-router'
  </verify>
  <done>AppShell and Sidebar components created with proper TypeScript types, Zustand integration, and RTL-ready logical CSS properties</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Run `npm run build` - should complete without errors
2. Run `npm run dev` - app should start
3. Visual check: Page loads with dark background immediately (no flash)
4. Components export correctly (no runtime import errors)
</verification>

<success_criteria>
- Dark theme applies on first paint (no FOUC)
- AppShell component wraps content with sidebar layout
- Sidebar displays 5 navigation items with Heroicons (outline style)
- Sidebar collapse/expand works via Zustand store
- All CSS uses logical properties (ps-*, pe-*, start, end) for RTL readiness
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-navigation-ui-shell/03-01-SUMMARY.md`
</output>
