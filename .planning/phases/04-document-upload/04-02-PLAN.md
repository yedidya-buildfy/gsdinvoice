---
phase: 04-document-upload
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/hooks/useDocuments.ts
  - src/components/documents/DocumentList.tsx
  - src/components/documents/DocumentCard.tsx
  - src/components/documents/DocumentThumbnail.tsx
  - src/pages/InvoicesPage.tsx
autonomous: true

must_haves:
  truths:
    - "User can see uploaded documents in a list"
    - "Documents display with thumbnails"
    - "List shows file name, type, upload date"
    - "Empty state shown when no documents"
  artifacts:
    - path: "src/hooks/useDocuments.ts"
      provides: "TanStack Query hook for fetching documents"
      exports: ["useDocuments"]
    - path: "src/components/documents/DocumentList.tsx"
      provides: "Grid/list view of uploaded documents"
      min_lines: 40
    - path: "src/components/documents/DocumentCard.tsx"
      provides: "Individual document display card"
      min_lines: 30
  key_links:
    - from: "src/components/documents/DocumentList.tsx"
      to: "src/hooks/useDocuments.ts"
      via: "query hook"
      pattern: "useDocuments"
    - from: "src/hooks/useDocuments.ts"
      to: "supabase"
      via: "database query"
      pattern: "supabase\\.from\\('files'\\)"
    - from: "src/components/documents/DocumentThumbnail.tsx"
      to: "src/lib/storage.ts"
      via: "get file URL"
      pattern: "getFileUrl"
---

<objective>
Create document list view with thumbnails to display uploaded files.

Purpose: After uploading documents, users need to see what they've uploaded. The list provides visual confirmation and allows users to review their documents before AI extraction. Thumbnails help identify documents quickly without opening them.

Output: Document grid showing all uploaded files with thumbnails, file info, and empty state.
</objective>

<execution_context>
@/Users/yedidya/.claude/get-shit-done/workflows/execute-plan.md
@/Users/yedidya/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/lib/supabase.ts
@src/lib/storage.ts
@src/types/database.ts
@src/pages/InvoicesPage.tsx
@src/styles/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useDocuments query hook</name>
  <files>
    src/hooks/useDocuments.ts
  </files>
  <action>
Create TanStack Query hook in src/hooks/useDocuments.ts:

Import useQuery from @tanstack/react-query and supabase from @/lib/supabase.
Import File type from @/types/database.

- useDocuments(options?: { sourceType?: string }) returns useQuery result
- Query key: ['documents', sourceType] - allows filtering by source type
- Query function:
  1. Build query: supabase.from('files').select('*')
  2. If sourceType provided, add .eq('source_type', sourceType)
  3. Order by created_at desc (newest first)
  4. Return data or throw error
- Configure:
  - staleTime: 30 * 1000 (30 seconds, matches existing pattern)
  - Use File[] as the return type

Also export a helper type:
- DocumentWithUrl: File & { url: string } (for components that need the URL)

Helper function getDocumentsWithUrls(documents: File[]): DocumentWithUrl[]
- Import getFileUrl from storage.ts
- Map each document, adding url property using getFileUrl(doc.storage_path)
  </action>
  <verify>
Run TypeScript check: `npm run build` passes.
Hook exports useDocuments and getDocumentsWithUrls.
  </verify>
  <done>
useDocuments hook fetches documents from files table using TanStack Query with proper caching. Helper function adds URLs to documents for display.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create document display components</name>
  <files>
    src/components/documents/DocumentThumbnail.tsx
    src/components/documents/DocumentCard.tsx
    src/components/documents/DocumentList.tsx
    src/pages/InvoicesPage.tsx
  </files>
  <action>
Create DocumentThumbnail in src/components/documents/DocumentThumbnail.tsx:
- Props: { url: string, fileType: string, fileName: string }
- For images (fileType === 'image'):
  - Render img tag with object-cover, rounded corners
  - Add loading="lazy" for performance
- For PDF:
  - Show DocumentTextIcon (outline) with bg-red-500/20 icon container
  - Text label: "PDF"
- For xlsx:
  - Show TableCellsIcon (outline) with bg-green-500/20 container
  - Text label: "XLSX"
- For csv:
  - Show TableCellsIcon (outline) with bg-blue-500/20 container
  - Text label: "CSV"
- Fallback: DocumentIcon with neutral bg
- All thumbnails same size: w-full aspect-square (square ratio)

Create DocumentCard in src/components/documents/DocumentCard.tsx:
- Props: { document: DocumentWithUrl }
- Card container: bg-surface rounded-lg overflow-hidden hover:ring-1 hover:ring-primary/50 transition
- Thumbnail at top (using DocumentThumbnail)
- Below thumbnail:
  - File name (truncated, text-sm font-medium text-text)
  - File size formatted (text-xs text-text-muted)
  - Upload date formatted (text-xs text-text-muted) - use Intl.DateTimeFormat for locale-aware formatting
  - Status badge: pending (yellow), processing (blue), extracted (green), error (red)
- Use HeroIcons for status badges

Create DocumentList in src/components/documents/DocumentList.tsx:
- Props: { sourceType?: string }
- Use useDocuments hook with sourceType filter
- Loading state: Show skeleton cards (3-4 placeholder cards with pulse animation)
- Error state: Show error message with retry button
- Empty state:
  - Icon: DocumentPlusIcon (outline)
  - Text: "No documents uploaded yet"
  - Subtext: "Upload invoices and receipts to get started"
- Success state:
  - Grid layout: grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4
  - Render DocumentCard for each document
  - Use getDocumentsWithUrls to add URLs

Update InvoicesPage.tsx:
- Add DocumentList below FileUploader
- Add refetch callback: pass onUploadComplete to FileUploader that invalidates documents query
- Section heading: "Your Documents" with count badge
- Layout:
  - FileUploader in collapsible section at top (or always visible)
  - DocumentList below taking remaining space
  </action>
  <verify>
Start dev server: `npm run dev`
Navigate to /invoices:
1. If no documents: see empty state with icon and message
2. Upload a file using FileUploader
3. After upload completes, list should refresh (via invalidation)
4. New document appears with thumbnail
5. Image files show actual image thumbnail
6. PDF/xlsx/csv show icon-based thumbnails
7. Hover on card shows ring effect
8. Responsive: grid adjusts columns on resize
  </verify>
  <done>
DocumentList displays all uploaded documents in a responsive grid. Each DocumentCard shows thumbnail, file info, and status. Empty state guides users to upload. List refreshes after new uploads.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run build` passes
2. Navigate to /invoices with no documents - see empty state
3. Upload files - list refreshes automatically
4. Documents show with appropriate thumbnails
5. File info (name, size, date) displays correctly
6. Grid is responsive across screen sizes
7. Status badges show correct state
</verification>

<success_criteria>
- User can view uploaded documents in a list (UPLD-03)
- Documents display with thumbnails (images show actual preview, others show icons)
- List shows file name, type, size, and upload date
- Empty state provides guidance
- List refreshes after upload completes
</success_criteria>

<output>
After completion, create `.planning/phases/04-document-upload/04-02-SUMMARY.md`
</output>
